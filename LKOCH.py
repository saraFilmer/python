import requests
import re  # ×‘×©×‘×™×œ ×”×‘×“×™×§×ª ×ª×§×™× ×•×ª

# ×‘×©×‘×™×œ ×”×¦×‘×¢×™×
from colorama import init, Fore, Back, Style

# ×›×ª×•×‘×ª ×”×©×¨×ª
BASE_URL = "http://127.0.0.1:5000"  # ×”×’×“×¨×ª ×›×ª×•×‘×ª ×”×©×¨×ª
session = requests.Session()  # ×™×¦×™×¨×ª ×¡×©×Ÿ ×—×“×©


init()


# ×¨×™×©×•× ××©×ª××© ×—×“×©
def register(username, password):
    if not username or not password:
        print(Fore.RED + "âš ï¸××–×”×¨×”: ×™×© ×œ××œ× ××ª ×©× ×”××©×ª××© ×•×”×¡×™×¡××”." + Style.RESET_ALL)
        return  # ×™×¦×™××” ××”×¤×•× ×§×¦×™×”
    response = session.post(  # ××›×™×œ ××ª ×”×ª×’×•×‘×” ××”×©×¨×ª ×œ××—×¨ ×©×œ×™×—×ª ×”×‘×§×©×”
        f"{BASE_URL}/register",
        json={"username": username, "password": password},  # ×”×¢×‘×¨×ª × ×ª×•× ×™ ×”××©×ª××©
    )
    print(response.json())  # ×”×“×¤×¡×ª ×”×ª×’×•×‘×” ××”×©×¨×ª


# ×”×ª×—×‘×¨×•×ª ××©×ª××© ×§×™×™×
def login(username, password):
    if not username or not password:
        print(Fore.RED + "âš ï¸××–×”×¨×”: ×™×© ×œ××œ× ××ª ×©× ×”××©×ª××© ×•×”×¡×™×¡××”." + Style.RESET_ALL)
        return
    response = session.post(  # ×©×œ×™×—×ª ×‘×§×©×ª POST ×œ×©×¨×ª
        f"{BASE_URL}/login",
        json={"username": username, "password": password},
    )
    if response.status_code == 200:  # ×‘×“×™×§×” ×× ×”×”×ª×—×‘×¨×•×ª ×”×¦×œ×™×—×”
        print(response.json()["message"])
    else:
        print(response.json()["error"])


# ×”×ª× ×ª×§×•×ª ××©×ª××©
def logout():
    response = session.post(f"{BASE_URL}/logout")  # ×©×œ×™×—×ª ×‘×§×©×ª POST ×œ×©×¨×ª ×œ×”×ª× ×ª×§×•×ª
    if response.status_code == 200:
        print("×—×‘×œ! ×”×ª× ×ª×§×ª ×‘×”×¦×œ×—×”âœ….")
    else:
        print(Fore.RED + "âš ï¸××–×”×¨×”: ×œ× × ×™×ª×Ÿ ×œ×”×ª× ×ª×§!!!!!!" + Style.RESET_ALL)


# ×”×ª×—×œ×ª ××©×—×§ ×—×“×©
def start_game(word_choice):
    response = session.get(
        f"{BASE_URL}/start_game/{word_choice}"
    )  # ×©×œ×™×—×ª ×‘×§×©×ª GET ×œ×©×¨×ª ×œ×”×ª×—×œ×ª ××©×—×§
    if response.status_code == 200:  # ×”×ª×—×™×œ ×‘×”×¦×œ×—×”
        return response.json().get("word")  # ×”×—×–×¨×ª ×”××™×œ×” ××”×©×¨×ª
    else:
        print(
            response.json().get("error", "âš ï¸××–×”×¨×”: × ×“×¨×© ×œ×”×¨×©× ×•×œ×”×ª×—×‘×¨ ×œ×¤× ×™ ×”×ª×—×œ×ª ×”××©×—×§")
        )
        return None


# ×”×¦×’ ×”×™×¡×˜×•×¨×™×™×ª ××©×—×§×™×
def show_history():
    response = session.get(
        f"{BASE_URL}/history"
    )  # ×©×•×œ×— ×‘×§×©×” GET ×œ×©×¨×ª ×œ×§×‘×œ×ª ×”×™×¡×˜×•×¨×™×™×ª ××©×—×§×™×
    if response.status_code == 200:  # ×”×ª×§×‘×œ×” ×‘×”×¦×œ×—×”
        history = response.json().get("history", [])  # ×§×‘×œ×ª ×”×™×¡×˜×•×¨×™×™×ª ×”××©×—×§×™×
        wins = sum(
            1 for entry in history if entry.get("won", False)
        )  # ×—×™×©×•×‘ ××¡×¤×¨ ×”× ×™×¦×—×•× ×•×ª
        losses = len(history) - wins  # ×—×™×©×•×‘ ××¡×¤×¨ ×”×”×¤×¡×“×™×

        print(f"×¡×š ×”×›×œ ××©×—×§×™×:{len(history)} × ×™×¦×—×•× ×•×ª:, {wins} ×”×¤×¡×“×™×: {losses}")

        if not history:
            print("××™×Ÿ ×œ×š ×”×™×¡×˜×•×¨×™×•×ª. ×ª×ª×—×™×œ ×œ×©×—×§ ×‘××©×—×§ ×©×œ× ×• ×•×ª×•×›×œ ×œ×¦×¤×•×ª ×‘××©×—×§×™× ×©×œ×š!!!")
            return

        for entry in history:  # ×¢×‘×•×¨ ×›×œ ×”×™×¡×˜×•×¨×™×”
            won_status = "×›×ŸâœŒï¸" if entry.get("won", False) else "×œ×ğŸ™…â€â™€ï¸"
            print(
                f"×”×ª××¨×™×š:ğŸ“…{entry['date']}, ×”×©×¢×”:ğŸ•°ï¸ {entry['time']} × ×™×¦×—×•×Ÿ: {won_status}, ×”××™×œ×”:ğŸ“– {entry.get('word', '×œ× ×™×“×•×¢')}"
            )
    else:
        print(
            Fore.RED
            + "âš ï¸××–×”×¨×”: ××™×Ÿ ×œ×š ×”×™×¡×˜×•×¨×™×•×ª. ×ª×ª×—×™×œ ×œ×©×—×§ ×‘××©×—×§ ×©×œ× ×• ×•×ª×•×›×œ ×œ×¦×¤×•×ª ×‘××©×—×§×™× ×©×œ×š!!!"
            + Style.RESET_ALL
        )


# ×¢×“×›×•×Ÿ ××¦×‘ ×”××©×—×§
def update_game(won, word):
    response = session.post(
        f"{BASE_URL}/update_game", json={"won": won, "word": word}
    )  # ×©×•×œ×— ×‘×§×©×ª POST ×œ×¢×“×›×•×Ÿ ××¦×‘ ×”××©×—×§
    try:
        response_data = response.json()  # ×”××¨×” ×œ××•×‘×™×™×§×˜ JSON
        if response.status_code == 200:
            print(response_data["message"])
        else:
            print(response_data.get("error", "×©×’×™××” ×‘×¢×“×›×•×Ÿ ××¦×‘ ×”××©×—×§."))
    except ValueError:
        print("×©×’×™××”: ×”×ª×’×•×‘×” ××”×©×¨×ª: ×‘×¢×™×” ×‘×”××¨×”")
    except Exception as e:
        print(f"×©×’×™××”: {str(e)}")


print("×‘×¡×™×¢×ª× ×“×™×©××™×")

logo = r"""
            _    _
           | |  | |
           | |__| | __ _ _ __   __ _ _ __ ___   __ _ _ __
           |  __  |/ _' | '_ \ / _' | '_ ' _ \ / _' | '_ \
           | |  | | (_| | | | | (_| | | | | | | (_| | | | |
           |_|  |_|\__,_|_| |_|\__, |_| |_| |_|\__,_|_| |_|
                                __/ |
                               |___/
    """
print(logo)


# ××ª×—×•×œ ×©×œ colorama
init()


text = """×©×œ×•× ×”×’×¢×ª× ×œ××©×—×§ ×”×—×“×© ×©×œ× ×• ×”××Ÿ ×ª×œ×•×™ ×¢×œ ×¢×¥!
×‘×• ×ª×•×›×œ×• ×œ×¦×¤×•×ª ×‘× ×™×¦×—×•× ×•×ª ×•×›×Ÿ ×‘×”×¤×¡×“×™× ×©×œ×›×!
×•×œ×”× ×•×ª ×‘××©×—×§ ××¤×ª×™×¢ ×•×××ª×’×¨- 
×•×›×Ÿ ××¨×¢× ×Ÿ ×‘×××¦×¢ ×—×™×™ ×©×™×’×¨×”----
×”×•×¨××•×ª ×”××©×—×§:
×™×©× × ×œ×¤× ×™×š 5 ××•×¤×¦×™×•×ª.
×‘××•×¤×¦×™×” ×¨××©×•× ×” ×ª×•×›×œ×• ×œ×”×ª×—×‘×¨ ××œ×™× ×•! ×•×œ×”×ª×—×™×œ ×œ×©×—×§!   
××š ×–×™×›×¨×• ×–×” ×›××•×‘×Ÿ ×‘×ª× ××™ ×©×›×‘×¨ ××ª× ××›×™×¨×™× ××•×ª× ×• ×•×›× ×¡×ª× ×œ××©×—×§ ×©×œ×•.
×•×× ×œ×• ×‘×¨×•×›×” ×”×‘××”!
×”×™× ×›× ×™×›×•×œ×™× ×œ×œ×—×•×¥ ×¢×œ ××§×© 2 ×‘××™×§×œ×“×ª ×©×œ×›× ×•×œ×”×’×™×¢ ×œ×”×¨×©××” ××œ×™× ×• ×•×œ×”×™×•×ª ××—×•×‘×¨×™× ×œ××¢×¨×›×ª ×©×œ× ×•-  
×•×× ××ª× × ×¨×©××™× ××œ×™× ×• ×‘×¤×¢× ×”×‘××” ×©×ª×™×¨×¦×• ×œ×©×—×§ ×‘××©×—×§ ×”××Ÿ ×ª×œ×•×™ ×¢×œ ×¢×¥ ×¨×§ ×ª×™×¦×˜×¨×›×• ×œ×”×ª×—×‘×¨ ××œ×™× ×•!  
×›××•×‘×Ÿ ×–×™×›×¨×• ××ª ×©× ××©×ª××© ×©×¢×œ ×©××• × ×¨×©××ª× ×•×›×Ÿ ×”×¡×™×¡××” ×©×œ×• ×œ×¤×¢× ×”×‘××”!
××¤×©×¨×•×ª 3 ×‘×• ×× ×ª×¨×¦×• ×œ×”×¤×¡×™×§ ×›×“×™ ×œ×©×ª×•×ª ×‘×××¦×¢ ×›×•×¡ ×§×¤× ×•××©×”×• ×§×˜×Ÿ ×œ××›×•×œ
×ª×•×›×œ×• ×œ×œ×—×•×¥ 3 ×›×“×™ ×œ×”×ª× ×ª×§ ×•×›×“×™ ×œ×—×–×•×¨ ××œ×™× ×• ×ª×ª×—×‘×¨×• ××œ×™× ×• ×©×•×‘!
×•×¢×œ ××§×© 4 ×‘×• ×××© ××ª×—×™×œ ×”××©×—×§ ×“×¢×• ×™×© ×œ××©×—×§ ×–××Ÿ ××•×’×‘×œ ×‘×• ×ª×•×›×œ×• ×œ×©×—×§!!
×”××©×—×§ ×©×œ×›× ×›×•×œ×œ 10 ×“×§×•×ª ×‘×“×™×•×§ ×•×œ××—×¨ ××›×Ÿ ×”××©×—×§ × ×™×’××¨!!!!
×•×‘××§×© 5 ×™×©× ×• ××¤×©×¨×•×ª ×œ×¨××•×ª ××ª ×”×™×¡×˜×•×¨×™×ª ×”× ×™×¦×—×•× ×•×ª ×©×œ×š ××• ×—"×• ×”×”×¤×¡×“×™× ×©×œ×š!
×”×–×“×¨×–×• ×•×”×›× ×¡×• ××œ×™× ×• ×¢×›×©×™×• ×ª×”× ×•----!!!!!!!!!
××©×—×§ ××”× ×” ×”×ª×—×™×œ×• ×œ×”××¨×™× ××œ×™× ×•ğŸ›©ï¸ğŸ›©ï¸ğŸ›©ï¸ğŸ›©ï¸ğŸ›©ï¸ğŸ›©ï¸ğŸ›©ï¸ğŸ›©ï¸ğŸ›©ï¸"""

print(Fore.MAGENTA + text)

print(Fore.RESET)


# ×”×¤×¢×œ×ª ×”××©×—×§
def play_hangman():
    print("1. ×œ×”×ª×—×‘×¨×•×ªğŸªª")
    print("2. ×œ×”×¨×©××”ğŸ“")
    print("3. ×œ×™×¦×™××”ğŸš¶â€â™‚ï¸")
    print("4. ×œ×”×ª×—×œ×ª ××©×—×§ğŸªœ")
    print("5. ×œ×”×¦×’×ª ×”×™×¡×˜×•×¨×™×”â€ğŸ’»")

    while True:
        try:
            choice = int(input("\033[96m×‘×—×¨ ××•×¤×¦×™×”â“: \033[0m"))
            if choice in [1, 2, 3, 4, 5]:  # ×‘×“×™×§×” ×”×× ×”××©×ª××© ×œ×—×¥ ×¢×œ ××¡×¤×¨ ×‘×™×Ÿ 1-5
                break
            else:
                print(
                    Fore.RED
                    + "××–×”×¨×”:âš ï¸ ×™×© ×œ×”×›× ×™×¡ ××¡×¤×¨ ×‘×™×Ÿ 1 ×œ-5 ×‘×œ×‘×“."
                    + Style.RESET_ALL
                )
        except ValueError:
            print(Fore.RED + "××–×”×¨×”:âš ï¸ ×™×© ×œ×”×›× ×™×¡ ××¡×¤×¨ ×‘×œ×‘×“." + Style.RESET_ALL)

    if choice == 1:
        username = input("×”×›× ×¡ ×©× ××©×ª××©: ")
        password = input("×”×›× ×¡ ×¡×™×¡××”: ")
        login(username, password)  # ×§×¨×™××” ×œ×¤×•× ×§×¦×™×™×ª ×”×ª×—×‘×¨×•×ª

    elif choice == 2:
        username = input("×”×›× ×¡ ×©× ××©×ª××©: ")
        password = input("×”×›× ×¡ ×¡×™×¡××”: ")
        register(username, password)  # ×§×¨×™××” ×œ×¤×•× ×§×¦×™×™×ª ×¨×™×©×•×

    elif choice == 3:
        logout()  # ×§×¨×™××” ×œ×¤×•× ×§×¦×™×™×ª ×”×ª× ×ª×§×•×ª
        return

    elif choice == 4:
        if not session.cookies:  # ×‘×“×™×§×” ×× ××™×Ÿ ×¢×•×’×™×•×ª ×‘×¡×©×Ÿ
            print(
                Fore.RED
                + "âš ï¸××–×”×¨×”: × ×“×¨×© ×œ×”×¨×©× ×•×œ×”×ª×—×‘×¨ ×œ×¤× ×™ ×”×ª×—×œ×ª ×”××©×—×§"
                + Style.RESET_ALL
            )
            return

        while True:
            try:
                word_choice = int(input("\033[96m×”×›× ×¡ ××¡×¤×¨ ×œ×‘×—×™×¨×ª ××™×œ×”ğŸ‘ˆ: \033[0m"))
                break
            except ValueError:
                print(Fore.RED + "××–×”×¨×”:âš ï¸ ×™×© ×œ×”×›× ×™×¡ ××¡×¤×¨ ×‘×œ×‘×“." + Style.RESET_ALL)

        word = start_game(word_choice)  # ×§×‘×œ×ª ×”××™×œ×” ××”×©×¨×ª
        if word:
            hidden_word = "_" * len(word)
            print("×”××™×œ×” ×”×™×:", hidden_word)

            attempts = 7  # ××¡×¤×¨ ×”× ×™×¡×™×•× ×•×ª
            guessed_letters = []  # ×¨×©×™××ª ×”××•×ª×™×•×ª ×©× ×™×—×©×•

            while attempts > 0:
                guess = input("×”×›× ×¡ ××•×ª: ").lower()  # ×××™×¨ ×××•×ª×™×•×ª ×’×“×•×œ×•×ª ×œ×§×˜× ×•×ª

                if not re.match("^[×-×ª]$", guess):
                    print(
                        Fore.RED
                        + "××–×”×¨×”:âš ï¸ ×™×© ×œ×”×›× ×™×¡ ××•×ª ×‘×¢×‘×¨×™×ª ×‘×œ×‘×“."
                        + Style.RESET_ALL
                    )
                    continue  # ×—×–×¨×” ×œ×”×ª×—×œ×ª ×”×œ×•×œ××”

                if guess in guessed_letters:  # ×‘×“×™×§×” ×× ×”××•×ª ×›×‘×¨ × ×™×—×©×”
                    print(
                        Fore.RED
                        + "××–×”×¨×”:âš ï¸ ×›×‘×¨ × ×™×—×©×ª ××ª ×”××•×ª ×”×–×•, × ×¡×” ××•×ª ××—×¨×ª."
                        + Style.RESET_ALL
                    )
                    continue  # ×—×–×¨×” ×œ×”×ª×—×œ×ª ×”×œ×•×œ××”

                guessed_letters.append(guess)  # ×”×•×¡×¤×ª ×”××•×ª ×œ×¨×©×™××ª ×”××•×ª×™×•×ª ×”× ×™×—×©×•×ª

                if guess in word:  # ×‘×“×™×§×” ×× ×”× ×™×—×•×© × ×›×•×Ÿ
                    print(Back.YELLOW + "× ×›×•×Ÿ!" + Style.RESET_ALL)
                else:
                    attempts -= 1  # ×”×¤×—×ª×ª × ×™×¡×™×•× ×•×ª
                    print(
                        Back.BLACK
                        + f"×˜×¢×™×ª!âŒ × ×•×ª×¨×• ×œ×šâŒ› {attempts} ×¤×¡×™×œ×•×ª."
                        + Style.RESET_ALL
                    )

                    if attempts == 6:
                        print(r"""      ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤   """)
                    elif attempts == 5:
                        print(
                            r"""
                    ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤
                                 ğŸŸ¤
                                 ğŸŸ¤
                                 ğŸŸ¤
                                 ğŸŸ¤
                                 ğŸŸ¤
                                                          """
                        )
                    elif attempts == 4:
                        print(
                            r"""
                    ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤
                    ğŸŸ¤           ğŸŸ¤
                    ğŸ˜Š           ğŸŸ¤
                                 ğŸŸ¤
                                 ğŸŸ¤
                                 ğŸŸ¤
                                                              """
                        )
                    elif attempts == 3:
                        print(
                            r"""
                    ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤
                    ğŸŸ¤           ğŸŸ¤
                    ğŸ˜Š           ğŸŸ¤
                    ğŸŸ¢           ğŸŸ¤
                                 ğŸŸ¤
                                 ğŸŸ¤
                                 ğŸŸ¤



                                                                                     """
                        )
                    elif attempts == 2:
                        print(
                            r"""
                    ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤
                    ğŸŸ¤           ğŸŸ¤
                    ğŸ˜Š           ğŸŸ¤
                  ğŸŸ¢ğŸŸ¢ğŸŸ¢         ğŸŸ¤
                                  ğŸŸ¤
                                  ğŸŸ¤
                                  ğŸŸ¤

     """
                        )
                    elif attempts == 1:
                        print(
                            r"""
                    ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤
                    ğŸŸ¤            ğŸŸ¤
                    ğŸ˜Š            ğŸŸ¤
                  ğŸŸ¢ğŸŸ¢ğŸŸ¢          ğŸŸ¤
                      ğŸ¦µ          ğŸŸ¤
                                  ğŸŸ¤
                                  ğŸŸ¤
                                                                                                              """
                        )
                    elif attempts == 0:
                        print(
                            r"""
                    ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤ğŸŸ¤
                    ğŸŸ¤           ğŸŸ¤
                    ğŸ˜Š           ğŸŸ¤
                  ğŸŸ¢ğŸŸ¢ğŸŸ¢         ğŸŸ¤
                    ğŸ¦µğŸ¦µ         ğŸŸ¤
                                  ğŸŸ¤
                                  ğŸŸ¤
                                                                                                                  """
                        )
                # ××¦×™×’ ××ª ×”××™×œ×” ×”××•×¡×ª×¨×ª ×¢× ×”××•×ª×™×•×ª ×”× ×™×—×©×•×ª
                hidden_word = "".join(
                    letter if letter in guessed_letters else "_" for letter in word
                )
                print("×”××™×œ×” ×”×™×:", hidden_word)
                if "_" not in hidden_word:  # ×× ×œ× × ×•×ª×¨×• ××•×ª×™×•×ª × ×¡×ª×¨×•×ª
                    print("× ×™×—×©×ª ××ª ×”××™×œ×”! ×›×œ ×”×›×‘×•×“!ğŸ‘")
                    print(" ×”××™×œ×” ×”×™×:" + hidden_word)
                    break

            if attempts == 0:  # ×× × ×’××¨×• ×”× ×™×¡×™×•× ×•×ª
                print(Fore.BLUE + f"×”×¤×¡×“×ª!ğŸ™ ×”××™×œ×” ×”×™×™×ª×”: {word}" + Style.RESET_ALL)
                update_game(False, word)  # ×× × ×¤×¡×œ ××– ××¢×“×›×Ÿ FALSE ×•××¢×“×›×Ÿ ××ª ×”××™×œ×”
            else:
                update_game(True, word)  # ×× × ×™×¦×— ××– ××¢×“×›×Ÿ TRUE ×•××¢×“×›×Ÿ ××ª ×”××™×œ×”

    elif choice == 5:
        show_history()  # ×§×¨×™××” ×œ×¤×•× ×§×¦×™×™×ª ×”×¦×’×ª ×”×™×¡×˜×•×¨×™×”


if __name__ == "__main__":
    while True:
        play_hangman()  # ×§×¨×™××” ×œ×¤×•× ×§×¦×™×™×ª ×”×¤×¢×œ×ª ×”××©×—×§
